{"version":3,"sources":["RAF.js","jcw2d.js","texture.js","tween.js"],"names":["lastTime","vendors","x","length","window","requestAnimationFrame","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","RAF","requestAnimFrame","Animate","this","MST","MAT","fx","complete","moving","infinity","alternate","repeats","root","JC","VERSION","blendModes","NORMAL","ALPHA","ADD","MULTIPLY","SCREEN","scaleModes","DEFAULT","LINEAR","NEAREST","_UID","Float32Array","Uint16Array","Uint32Array","ArrayBuffer","console","log","PI_2","PI","RTD","DTR","dontSpeek","defaultRenderOptions","view","transparent","antialias","preserveDrawingBuffer","resolution","clearBeforeRender","autoResize","sayHello","type","navigator","userAgent","toLowerCase","indexOf","args","apply","Point","y","prototype","clone","set","constructor","Matrix","a","b","c","d","tx","ty","fromArray","array","toArray","transpose","pos","newPos","applyInverse","translate","scale","rotate","angle","cos","sin","a1","c1","tx1","append","matrix","b1","d1","identity","identityMatrix","moveTween","opts","now","MATR","attr","time","MATRC","i","manager","nextPose","setVal","TWEEN","DisplayObject","call","visible","worldAlpha","alpha","scaleX","scaleY","skewX","skewY","rotation","rotationCache","_sr","_cr","pivotX","pivotY","_mask","parent","worldTransform","renderable","_cacheAsBitmap","_cacheIsDirty","Object","create","defineProperty","get","value","isMask","_generateCachedSprite","_destroyCachedSprite","vals","undefined","key","updateTransform","pt","wt","displayObjectUpdateTransform","getBounds","EmptyRectangle","getLocalBounds","generateTexture","scaleMode","renderer","bounds","renderTexture","RenderTexture","width","height","_tempMatrix","render","updateCache","_renderCachedSprite","renderSession","_cachedSprite","gl","Sprite","texture","resize","destroy","DisplayObjectContainer","children","addChild","child","addChildAt","index","removeChild","splice","Error","swapChildren","child2","index1","getChildIndex","index2","setChildIndex","currentIndex","getChildAt","removeChildAt","stage","removeStageReference","removeChildren","beginIndex","endIndex","begin","end","range","removed","j","displayObjectContainerUpdateTransform","maskManager","pushMask","mask","popMask","sH","sW","tint","blendMode","shader","repeatX","repeatY","buildMesh","w","h","vertices","indices","rX","rY","uvs","cachedTint","dirty","createBuffer","vertexBuffer","uvsBuffer","indicesBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","ELEMENT_ARRAY_BUFFER","STATIC_DRAW","syncUniforms","shaderManager","projection","uniform1i","uSampler","uniform1f","uAlpha","uniform2f","projectionVector","uniformMatrix3fv","uMatrix","uniform3fv","uTint","hex2rgb","syncAttribute","enableVertexAttribArray","aVertexPosition","vertexAttribPointer","FLOAT","aTextureCoord","upDate","texturesManager","setTexture","drawElements","TRIANGLES","UNSIGNED_SHORT","fromFrame","frameId","TextureCache","fromImage","imageId","crossorigin","Texture","Stage","backgroundColor","interactive","setBackgroundColor","bgc","hex","rgb2hex","rgb","Function","bind","thisArg","bound","arguments","Array","boundArgs","concat","target","TypeError","F","proto","getNextPowerOfTwo","number","result","isPowerOfTwo","CompileVertexShader","shaderSrc","_CompileShader","VERTEX_SHADER","CompileFragmentShader","FRAGMENT_SHADER","shaderType","src","join","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","compileProgram","vertexSrc","fragmentSrc","fragmentShader","vertexShader","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","SpriteShader","program","textureCount","init","useProgram","getUniformLocation","getAttribLocation","deleteProgram","uniforms","Renderer","options","devicePixelRatio","document","createElement","contextLostBound","handleContextLost","contextRestoredBound","handleContextRestored","addEventListener","_contextOptions","premultipliedAlpha","stencil","offset","ShaderManager","TexturesManager","WebGLMaskManager","blendModeManager","WebGLBlendModeManager","initContext","mapBlendModes","getContext","disable","DEPTH_TEST","CULL_FACE","enable","BLEND","setContext","contextLost","clearColor","clear","COLOR_BUFFER_BIT","renderDisplayObject","displayObject","buffer","setBlendMode","style","viewport","event","preventDefault","baseTexture","_glTextures","blendModesWebGL","ONE","ONE_MINUS_SRC_ALPHA","SRC_ALPHA","DST_ALPHA","DST_COLOR","textures","_UNITS","currentId","setPara","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","createTexture","texImage2D","RGBA","UNSIGNED_BYTE","img","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","unit","currentBlendMode","blendModeWebGL","blendFunc","shaders","setShader","_curShaderType","maskData","STENCIL_TEST","depthMask","colorMask","stencilFunc","ALWAYS","stencilOp","KEEP","REPLACE","EQUAL","exports","module","define","amd","TextureUvs","x0","y0","x1","y1","x2","y2","x3","y3","ImageLoader","sources","receiveNum","failNum","requestNum","imgs","loading","ears","source","onload","This","onLoaded","onFailed","onerror","Image","crossOrigin","getTexture","easeBoth","t","extend"],"mappings":"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","file":"../modules/jcw2d.js","sourcesContent":["(function() {\n    var lastTime = 0;\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\n    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n            window[vendors[x] + 'CancelRequestAnimationFrame'];\n    }\n\n    if (!window.requestAnimationFrame) {\n        window.requestAnimationFrame = function(callback) {\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = window.setTimeout(function() { callback(currTime + timeToCall); },\n              timeToCall);\n            lastTime = currTime + timeToCall;\n            return id;\n        };\n    }\n\n    if (!window.cancelAnimationFrame) {\n        window.cancelAnimationFrame = function(id) {\n            clearTimeout(id);\n        };\n    }\n\n    window.RAF = window.requestAnimFrame = window.requestAnimationFrame;\n})();","(function() {\n\n    var root = this;\n\n    var JC = JC || {};\n\n    JC.VERSION = \"v0.0.5\";\n\n    JC.blendModes = {\n        NORMAL: 0,\n        ALPHA: 1,\n        ADD: 2,\n        MULTIPLY: 3,\n        SCREEN: 4\n    };\n\n    JC.scaleModes = {\n        DEFAULT: 0,\n        LINEAR: 0,\n        NEAREST: 1\n    };\n\n    JC._UID = 0;\n\n    if (typeof(Float32Array) != 'undefined') {\n        JC.Float32Array = Float32Array;\n        JC.Uint16Array = Uint16Array;\n\n        JC.Uint32Array = Uint32Array;\n        JC.ArrayBuffer = ArrayBuffer;\n    } else {\n        console.log('%c not support WebGL ', 'color: #fff;background: #f00;');\n    }\n\n    JC.PI_2 = Math.PI * 2;\n\n    JC.RTD = 180 / Math.PI;\n\n    JC.DTR = Math.PI / 180;\n\n    JC.dontSpeek = false;\n\n    JC.defaultRenderOptions = {\n        view: null,\n        transparent: false,\n        antialias: false,\n        preserveDrawingBuffer: false,\n        resolution: 1,\n        clearBeforeRender: true,\n        autoResize: false\n    };\n\n    JC.sayHello = function(type) {\n        if (JC.dontSpeek) return;\n\n        if (navigator.userAgent.toLowerCase().indexOf('chrome') > -1) {\n            var args = [\n                '%c %c %c JC.js ' + JC.VERSION + ' - ' + type + '  %c ' + ' %c ' + ' http://www.JCjs.com/  %c %c ♥%c♥%c♥ ',\n                'background: #ff66a5',\n                'background: #ff66a5',\n                'color: #ff66a5; background: #030307;',\n                'background: #ff66a5',\n                'background: #ffc3dc',\n                'background: #ff66a5',\n                'color: #ff2424; background: #fff',\n                'color: #ff2424; background: #fff',\n                'color: #ff2424; background: #fff'\n            ];\n\n            console.log.apply(console, args);\n        }\n\n        JC.dontSpeek = true;\n    };\n\n\n    JC.Point = function(x, y) {\n        this.x = x || 0;\n\n        this.y = y || 0;\n    };\n    JC.Point.prototype.clone = function() {\n        return new JC.Point(this.x, this.y);\n    };\n    JC.Point.prototype.set = function(x, y) {\n        this.x = x || 0;\n        this.y = y || ((y !== 0) ? this.x : 0);\n    };\n    JC.Point.prototype.constructor = JC.Point;\n\n\n    /**\n     * The Matrix class is now an object, which makes it a lot faster, \n     * here is a representation of it : \n     * | a | b | tx|\n     * | c | d | ty|\n     * | 0 | 0 | 1 |\n     *\n     * @class Matrix\n     * @constructor\n     */\n    JC.Matrix = function() {\n        this.a = 1;\n        this.b = 0;\n        this.c = 0;\n        this.d = 1;\n        this.tx = 0;\n        this.ty = 0;\n    };\n    JC.Matrix.prototype.fromArray = function(array) {\n        this.a = array[0];\n        this.b = array[1];\n        this.c = array[3];\n        this.d = array[4];\n        this.tx = array[2];\n        this.ty = array[5];\n    };\n    JC.Matrix.prototype.toArray = function(transpose) {\n        if (!this.array) this.array = new JC.Float32Array(9);\n        var array = this.array;\n\n        if (transpose) {\n            array[0] = this.a;\n            array[1] = this.b;\n            array[2] = 0;\n            array[3] = this.c;\n            array[4] = this.d;\n            array[5] = 0;\n            array[6] = this.tx;\n            array[7] = this.ty;\n            array[8] = 1;\n        } else {\n            array[0] = this.a;\n            array[1] = this.c;\n            array[2] = this.tx;\n            array[3] = this.b;\n            array[4] = this.d;\n            array[5] = this.ty;\n            array[6] = 0;\n            array[7] = 0;\n            array[8] = 1;\n        }\n\n        return array;\n    };\n    JC.Matrix.prototype.apply = function(pos, newPos) {\n        newPos = newPos || new JC.Point();\n\n        newPos.x = this.a * pos.x + this.c * pos.y + this.tx;\n        newPos.y = this.b * pos.x + this.d * pos.y + this.ty;\n\n        return newPos;\n    };\n    JC.Matrix.prototype.applyInverse = function(pos, newPos) {\n        newPos = newPos || new JC.Point();\n\n        var id = 1 / (this.a * this.d + this.c * -this.b);\n\n        newPos.x = this.d * id * pos.x + -this.c * id * pos.y + (this.ty * this.c - this.tx * this.d) * id;\n        newPos.y = this.a * id * pos.y + -this.b * id * pos.x + (-this.ty * this.a + this.tx * this.b) * id;\n\n        return newPos;\n    };\n    JC.Matrix.prototype.translate = function(x, y) {\n        this.tx += x;\n        this.ty += y;\n\n        return this;\n    };\n    JC.Matrix.prototype.scale = function(x, y) {\n        this.a *= x;\n        this.d *= y;\n        this.c *= x;\n        this.b *= y;\n        this.tx *= x;\n        this.ty *= y;\n\n        return this;\n    };\n    JC.Matrix.prototype.rotate = function(angle) {\n        var cos = Math.cos(angle);\n        var sin = Math.sin(angle);\n\n        var a1 = this.a;\n        var c1 = this.c;\n        var tx1 = this.tx;\n\n        this.a = a1 * cos - this.b * sin;\n        this.b = a1 * sin + this.b * cos;\n        this.c = c1 * cos - this.d * sin;\n        this.d = c1 * sin + this.d * cos;\n        this.tx = tx1 * cos - this.ty * sin;\n        this.ty = tx1 * sin + this.ty * cos;\n\n        return this;\n    };\n    JC.Matrix.prototype.append = function(matrix) {\n        var a1 = this.a;\n        var b1 = this.b;\n        var c1 = this.c;\n        var d1 = this.d;\n\n        this.a = matrix.a * a1 + matrix.b * c1;\n        this.b = matrix.a * b1 + matrix.b * d1;\n        this.c = matrix.c * a1 + matrix.d * c1;\n        this.d = matrix.c * b1 + matrix.d * d1;\n\n        this.tx = matrix.tx * a1 + matrix.ty * c1 + this.tx;\n        this.ty = matrix.tx * b1 + matrix.ty * d1 + this.ty;\n\n        return this;\n    };\n    JC.Matrix.prototype.identity = function() {\n        this.a = 1;\n        this.b = 0;\n        this.c = 0;\n        this.d = 1;\n        this.tx = 0;\n        this.ty = 0;\n\n        return this;\n    };\n\n    JC.identityMatrix = new JC.Matrix();\n\n\n    function Animate(){\n        this.MST = 0;\n        this.MAT = 300;\n        this.fx = 'easeBoth';\n        this.complete = function(){};\n        this.moving = false;\n        this.infinity = false;\n        this.alternate = false;\n        this.repeats = 0;\n    }\n    Animate.prototype.moveTween = function(opts){\n        this.MST = Date.now();\n        this.MATR = opts.attr||this.MATR;\n        this.MAT = opts.time||this.MAT;\n        this.fx = opts.fx||this.fx;\n        this.complete = opts.complete||this.complete;\n        this.infinity = opts.infinity||this.infinity;\n        this.alternate = opts.alternate||this.alternate;\n        this.repeats = opts.repeats||this.repeats;\n        this.moving = true;\n        this.MATRC = {};\n        for(var i in this.MATR){\n            this.MATRC[i] = this[i];\n        }\n    };\n    Animate.prototype.manager = function(){\n        if(!this.moving)return;\n        var now = Date.now();\n        if(now < this.MST+this.MAT){\n            this.nextPose();\n        }else{\n            this.setVal(this.MATR);\n            if(this.repeats>0||this.infinity){\n                this.repeats>0&&--this.repeats;\n                if(this.alternate){\n                    this.moveTween({attr: this.MATRC});\n                }else{\n                    this.setVal(this.MATRC);\n                    this.moveTween({attr: this.MATR});\n                }\n            }else{\n                this.moving = false;\n                this.complete();\n                if(now>this.MST)this.complete = function(){};\n            }\n        }\n    };\n    Animate.prototype.nextPose = function(){\n        var now=Date.now()-this.MST;\n        for(var i in this.MATR){\n            this[i] = JC.TWEEN[this.fx]( now , this.MATRC[i] , this.MATR[i] - this.MATRC[i] , this.MAT );\n        }\n    };\n\n    JC.DisplayObject = function() {\n        Animate.call( this );\n        this.visible = true;\n        this.worldAlpha = 1;\n        this.alpha = 1;\n\n        this.scaleX = 1;\n        this.scaleY = 1;\n\n        this.skewX = 0;\n        this.skewY = 0;\n\n        this.rotation = 0;\n        this.rotationCache = 0;\n        this._sr = 0;\n        this._cr = 1;\n        \n        this.x = 0;\n        this.y = 0;\n        \n        this.pivotX = 0;\n        this.pivotY = 0;\n\n        this._mask = null;\n\n        this.parent = null;\n        this.worldTransform = new JC.Matrix();\n\n        this.renderable = false;\n\n        this._cacheAsBitmap = false;\n\n        this._cacheIsDirty = false;\n    };\n\n    JC.DisplayObject.prototype = Object.create( Animate.prototype );\n    JC.DisplayObject.prototype.constructor = JC.DisplayObject;\n\n    // Object.defineProperty(JC.DisplayObject.prototype, 'worldVisible', {\n    //     get: function() {\n    //         var item = this;\n\n    //         do {\n    //             if (!item.visible) return false;\n    //             item = item.parent;\n    //         }\n    //         while (item);\n\n    //         return true;\n    //     }\n    // });\n\n    Object.defineProperty(JC.DisplayObject.prototype, 'mask', {\n        get: function() {\n            return this._mask;\n        },\n        set: function(value) {\n\n            if (this._mask) this._mask.isMask = false;\n            this._mask = value;\n            if (this._mask) this._mask.isMask = true;\n        }\n    });\n\n    Object.defineProperty(JC.DisplayObject.prototype, 'cacheAsBitmap', {\n\n        get: function() {\n            return this._cacheAsBitmap;\n        },\n\n        set: function(value) {\n\n            if (this._cacheAsBitmap === value) return;\n\n            if (value) {\n                this._generateCachedSprite();\n            } else {\n                this._destroyCachedSprite();\n            }\n\n            this._cacheAsBitmap = value;\n        }\n    });\n\n    JC.DisplayObject.prototype.setVal = function(vals){\n        if(vals===undefined)return;\n        for(var key in vals){\n            if(this[key]===undefined){\n                continue;\n            }else{\n                this[key] = vals[key];\n            }\n        }\n    };\n\n    JC.DisplayObject.prototype.updateTransform = function() {\n        var pt = this.parent.worldTransform;\n        var wt = this.worldTransform;\n\n        var a, b, c, d, tx, ty;\n\n        if (this.rotation % JC.PI_2) {\n            if (this.rotation !== this.rotationCache) {\n                this.rotationCache = this.rotation;\n                this._sr = Math.sin(this.rotation);\n                this._cr = Math.cos(this.rotation);\n            }\n\n            a = this._cr * this.scaleX;\n            b = this._sr * this.scaleX;\n            c = -this._sr * this.scaleY;\n            d = this._cr * this.scaleY;\n            tx = this.x;\n            ty = this.y;\n\n            if (this.pivotX || this.pivotY) {\n                tx -= this.pivotX * a + this.pivotY * c;\n                ty -= this.pivotX * b + this.pivotY * d;\n            }\n\n            wt.a = a * pt.a + b * pt.c;\n            wt.b = a * pt.b + b * pt.d;\n            wt.c = c * pt.a + d * pt.c;\n            wt.d = c * pt.b + d * pt.d;\n            wt.tx = tx * pt.a + ty * pt.c + pt.tx;\n            wt.ty = tx * pt.b + ty * pt.d + pt.ty;\n\n\n        } else {\n            a = this.scaleX;\n            d = this.scaleY;\n\n            tx = this.x - this.pivotX * a;\n            ty = this.y - this.pivotY * d;\n\n            wt.a = a * pt.a;\n            wt.b = a * pt.b;\n            wt.c = d * pt.c;\n            wt.d = d * pt.d;\n            wt.tx = tx * pt.a + ty * pt.c + pt.tx;\n            wt.ty = tx * pt.b + ty * pt.d + pt.ty;\n        }\n\n        this.worldAlpha = this.alpha * this.parent.worldAlpha;\n\n        this.manager();\n    };\n\n    JC.DisplayObject.prototype.displayObjectUpdateTransform = JC.DisplayObject.prototype.updateTransform;\n\n    JC.DisplayObject.prototype.getBounds = function(matrix) {\n        matrix = matrix; //just to get passed js hinting (and preserve inheritance)\n        return JC.EmptyRectangle;\n    };\n\n    JC.DisplayObject.prototype.getLocalBounds = function() {\n        return this.getBounds(JC.identityMatrix);\n    };\n\n    JC.DisplayObject.prototype.generateTexture = function(resolution, scaleMode, renderer) {\n        var bounds = this.getLocalBounds();\n\n        var renderTexture = new JC.RenderTexture(bounds.width | 0, bounds.height | 0, renderer, scaleMode, resolution);\n\n        JC.DisplayObject._tempMatrix.tx = -bounds.x;\n        JC.DisplayObject._tempMatrix.ty = -bounds.y;\n\n        renderTexture.render(this, JC.DisplayObject._tempMatrix);\n\n        return renderTexture;\n    };\n\n    JC.DisplayObject.prototype.updateCache = function() {\n        this._generateCachedSprite();\n    };\n\n    JC.DisplayObject.prototype._renderCachedSprite = function(renderSession) {\n        this._cachedSprite.worldAlpha = this.worldAlpha;\n\n        if (renderSession.gl) JC.Sprite.prototype.render.call(this._cachedSprite, renderSession);\n    };\n\n    JC.DisplayObject.prototype._generateCachedSprite = function() {\n        this._cacheAsBitmap = false;\n        var bounds = this.getLocalBounds();\n\n        if (!this._cachedSprite) {\n            var renderTexture = new JC.RenderTexture(bounds.width | 0, bounds.height | 0);\n            this._cachedSprite = new JC.Sprite(renderTexture);\n            this._cachedSprite.worldTransform = this.worldTransform;\n        } else {\n            this._cachedSprite.texture.resize(bounds.width | 0, bounds.height | 0);\n        }\n\n        this._cacheAsBitmap = true;\n    };\n\n    JC.DisplayObject.prototype._destroyCachedSprite = function() {\n        if (!this._cachedSprite) return;\n\n        this._cachedSprite.texture.destroy(true);\n\n        this._cachedSprite = null;\n    };\n\n    JC.DisplayObject.prototype.render = function(renderSession) {\n        // OVERWRITE;\n        // this line is just here to pass jshinting :)\n        renderSession = renderSession;\n    };\n\n    JC.DisplayObject._tempMatrix = new JC.Matrix();\n\n    // Object.defineProperty(JC.DisplayObject.prototype, 'x', {\n    //     get: function() {\n    //         return this.position.x;\n    //     },\n    //     set: function(value) {\n    //         this.position.x = value;\n    //     }\n    // });\n\n    // Object.defineProperty(JC.DisplayObject.prototype, 'y', {\n    //     get: function() {\n    //         return this.position.y;\n    //     },\n    //     set: function(value) {\n    //         this.position.y = value;\n    //     }\n    // });\n\n\n\n    JC.DisplayObjectContainer = function() {\n        JC.DisplayObject.call(this);\n\n        this.children = [];\n    };\n\n    JC.DisplayObjectContainer.prototype = Object.create(JC.DisplayObject.prototype);\n    JC.DisplayObjectContainer.prototype.constructor = JC.DisplayObjectContainer;\n\n    // Object.defineProperty(JC.DisplayObjectContainer.prototype, 'width', {\n    //     get: function() {\n    //         return this.scale.x * this.getLocalBounds().width;\n    //     },\n    //     set: function(value) {\n\n    //         var width = this.getLocalBounds().width;\n\n    //         if (width !== 0) {\n    //             this.scale.x = value / width;\n    //         } else {\n    //             this.scale.x = 1;\n    //         }\n\n    //         this._width = value;\n    //     }\n    // });\n\n    // Object.defineProperty(JC.DisplayObjectContainer.prototype, 'height', {\n    //     get: function() {\n    //         return this.scale.y * this.getLocalBounds().height;\n    //     },\n    //     set: function(value) {\n\n    //         var height = this.getLocalBounds().height;\n\n    //         if (height !== 0) {\n    //             this.scale.y = value / height;\n    //         } else {\n    //             this.scale.y = 1;\n    //         }\n\n    //         this._height = value;\n    //     }\n    // });\n\n    JC.DisplayObjectContainer.prototype.addChild = function(child) {\n        return this.addChildAt(child, this.children.length);\n    };\n\n    JC.DisplayObjectContainer.prototype.addChildAt = function(child, index) {\n        if (index >= 0 && index <= this.children.length) {\n            if (child.parent) {\n                child.parent.removeChild(child);\n            }\n\n            child.parent = this;\n\n            this.children.splice(index, 0, child);\n\n            // if (this.stage) child.setStageReference(this.stage);\n\n            return child;\n        } else {\n            throw new Error(child + 'addChildAt: The index ' + index + ' supplied is out of bounds ' + this.children.length);\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.swapChildren = function(child, child2) {\n        if (child === child2) {\n            return;\n        }\n\n        var index1 = this.getChildIndex(child);\n        var index2 = this.getChildIndex(child2);\n\n        if (index1 < 0 || index2 < 0) {\n            throw new Error('swapChildren: Both the supplied DisplayObjects must be a child of the caller.');\n        }\n\n        this.children[index1] = child2;\n        this.children[index2] = child;\n\n    };\n\n    JC.DisplayObjectContainer.prototype.getChildIndex = function(child) {\n        var index = this.children.indexOf(child);\n        if (index === -1) {\n            throw new Error('The supplied DisplayObject must be a child of the caller');\n        }\n        return index;\n    };\n\n    JC.DisplayObjectContainer.prototype.setChildIndex = function(child, index) {\n        if (index < 0 || index >= this.children.length) {\n            throw new Error('The supplied index is out of bounds');\n        }\n        var currentIndex = this.getChildIndex(child);\n        this.children.splice(currentIndex, 1); //remove from old position\n        this.children.splice(index, 0, child); //add at new position\n    };\n\n    JC.DisplayObjectContainer.prototype.getChildAt = function(index) {\n        if (index < 0 || index >= this.children.length) {\n            throw new Error('getChildAt: Supplied index ' + index + ' does not exist in the child list, or the supplied DisplayObject must be a child of the caller');\n        }\n        return this.children[index];\n\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChild = function(child) {\n        var index = this.children.indexOf(child);\n        if (index === -1) return;\n\n        return this.removeChildAt(index);\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChildAt = function(index) {\n        var child = this.getChildAt(index);\n        if (this.stage)\n            child.removeStageReference();\n\n        child.parent = undefined;\n        this.children.splice(index, 1);\n        return child;\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChildren = function(beginIndex, endIndex) {\n        var begin = beginIndex || 0;\n        var end = typeof endIndex === 'number' ? endIndex : this.children.length;\n        var range = end - begin;\n\n        if (range > 0 && range <= end) {\n            var removed = this.children.splice(begin, range);\n            for (var i = 0; i < removed.length; i++) {\n                var child = removed[i];\n                if (this.stage)\n                    child.removeStageReference();\n                child.parent = undefined;\n            }\n            return removed;\n        } else if (range === 0 && this.children.length === 0) {\n            return [];\n        } else {\n            throw new Error('removeChildren: Range Error, numeric values are outside the acceptable range');\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.updateTransform = function() {\n        if (!this.visible) return;\n\n        this.displayObjectUpdateTransform();\n\n        for (var i = 0, j = this.children.length; i < j; i++) {\n            this.children[i].updateTransform();\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform = JC.DisplayObjectContainer.prototype.updateTransform;\n\n    JC.DisplayObjectContainer.prototype.render = function(renderSession) {\n        if (!this.visible || this.alpha <= 0) return;\n\n        if (this._cacheAsBitmap) {\n            this._renderCachedSprite(renderSession);\n            return;\n        }\n\n        var i, j;\n\n        if (this._mask) {\n\n            if (this._mask) {\n                renderSession.maskManager.pushMask(this.mask, renderSession);\n            }\n\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n            if (this._mask) renderSession.maskManager.popMask(this._mask, renderSession);\n\n        } else {\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n        }\n    };\n\n\n\n\n    JC.Sprite = function(opts) { // opts\n        JC.DisplayObjectContainer.call(this);\n\n        // this.anchor = new JC.Point();\n\n        this.texture = opts.texture;\n\n        this.width = opts.width||this.texture.width;\n\n        this.height = opts.height||this.texture.height;\n\n        this.sH = opts.sH||0;\n\n        this.sW = opts.sW||0;\n\n        this.tint = 0xFFFFFF;\n\n        this.blendMode = JC.blendModes.NORMAL;\n\n        this.shader = null;\n\n        this.repeatX = opts.repeatX||false;\n        this.repeatY = opts.repeatY||false;\n\n        this.renderable = true;\n\n        this.buildMesh();\n\n    };\n\n    JC.Sprite.prototype = Object.create(JC.DisplayObjectContainer.prototype);\n    JC.Sprite.prototype.constructor = JC.Sprite;\n\n\n    JC.Sprite.prototype.buildMesh = function() {\n        var w = this.texture.width,\n            h = this.texture.height;\n        this.vertices = new JC.Float32Array([\n                -this.width/2,this.height/2,\n                -this.width/2,-this.height/2,\n                this.width/2,-this.height/2,\n                this.width/2,this.height/2\n            ]);\n        this.indices = new JC.Uint16Array([\n                0,1,2,\n                0,2,3\n            ]);\n        if(this.repeatX || this.repeatY){\n            var rX = this.repeatX?2:1,\n                rY = this.repeatY?2:1;\n            this.uvs = new JC.Float32Array([\n                0*rX, 0*rY,\n                0*rX, 1*rY,\n                1*rX, 1*rY,\n                1*rX, 0*rY\n            ]);\n        }else{\n            this.uvs = new JC.Float32Array([\n                this.sW/w, this.sH/h,\n                this.sW/w, (this.sH+this.height)/h,\n                (this.sW+this.width)/w, (this.sH+this.height)/h,\n                (this.sW+this.width)/w, this.sH/h\n            ]);\n        }\n        this.cachedTint = this.tint||0xFFFFFF;\n        this.dirty = true;\n    };\n    \n    JC.Sprite.prototype.createBuffer = function(gl){\n        this.vertexBuffer = gl.createBuffer();\n        this.uvsBuffer = gl.createBuffer();\n        this.indicesBuffer = gl.createBuffer();\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, this.vertices, gl.DYNAMIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.uvsBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, this.uvs, gl.DYNAMIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indices, gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n        this.dirty = false;\n    };\n\n    JC.Sprite.prototype.syncUniforms = function(renderSession){\n        var gl = renderSession.gl,\n            shader = renderSession.shaderManager.shader,\n            projection = renderSession.projection;\n\n        gl.uniform1i(shader.uSampler, 0);\n        gl.uniform1f(shader.uAlpha, this.worldAlpha);\n        gl.uniform2f(shader.projectionVector, projection.x, projection.y);\n        gl.uniformMatrix3fv(shader.uMatrix, false, this.worldTransform.toArray(true));\n        gl.uniform3fv(shader.uTint, JC.hex2rgb(this.tint));\n\n    };\n\n    JC.Sprite.prototype.syncAttribute = function(renderSession){\n        var gl = renderSession.gl,\n            shader = renderSession.shaderManager.shader;\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n        gl.enableVertexAttribArray(shader.aVertexPosition);\n        gl.vertexAttribPointer(shader.aVertexPosition, 2, gl.FLOAT, false, 0, 0);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.uvsBuffer);\n        gl.enableVertexAttribArray(shader.aTextureCoord);\n        gl.vertexAttribPointer(shader.aTextureCoord, 2, gl.FLOAT, false, 0, 0);\n\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n    };\n\n    JC.Sprite.prototype.upDate = function(renderSession) {\n        renderSession.texturesManager.setTexture(this.texture);\n        this.dirty&&this.createBuffer(renderSession.gl);\n        this.syncAttribute(renderSession);\n        this.syncUniforms(renderSession);\n    };\n\n    JC.Sprite.prototype.render = function(renderSession) {\n        if (!this.visible || this.alpha <= 0) return;\n        this.upDate(renderSession);\n        var i, j, gl = renderSession.gl;\n\n        // do a quick check to see if this element has a mask or a filter.\n        if (this._mask) {\n\n            if (this._mask) {\n                renderSession.maskManager.pushMask(this.mask, renderSession);\n            }\n\n            // add this sprite to the batch\n            gl.drawElements(gl.TRIANGLES, this.indices.length, gl.UNSIGNED_SHORT, 0);\n\n            // now loop through the children and make sure they get rendered\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n            // time to stop the sprite batch as either a mask element or a filter draw will happen next\n\n            if (this._mask) renderSession.maskManager.popMask(this._mask, renderSession);\n        } else {\n\n            gl.drawElements(gl.TRIANGLES, this.indices.length, gl.UNSIGNED_SHORT, 0);\n\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n        }\n    };\n\n    JC.Sprite.fromFrame = function(frameId) {\n        var texture = JC.TextureCache[frameId];\n        if (!texture) throw new Error('The frameId \"' + frameId + '\" does not exist in the texture cache' + this);\n        return new JC.Sprite(texture);\n    };\n\n    JC.Sprite.fromImage = function(imageId, crossorigin, scaleMode) {\n        var texture = JC.Texture.fromImage(imageId, crossorigin, scaleMode);\n        return new JC.Sprite(texture);\n    };\n\n\n\n\n    JC.Stage = function(backgroundColor) {\n        JC.DisplayObjectContainer.call(this);\n\n        this.worldTransform = new JC.Matrix();\n\n        this.interactive = true;\n\n        this.dirty = true;\n\n        this.stage = this;\n\n        this.setBackgroundColor(backgroundColor);\n    };\n\n    JC.Stage.prototype = Object.create(JC.DisplayObjectContainer.prototype);\n    JC.Stage.prototype.constructor = JC.Stage;\n\n    JC.Stage.prototype.updateTransform = function() {\n        this.worldAlpha = 1;\n\n        for (var i = 0, j = this.children.length; i < j; i++) {\n            this.children[i].updateTransform();\n        }\n    };\n\n    JC.Stage.prototype.setBackgroundColor = function(bgc) {\n        if (typeof bgc === 'number') return;\n        this.backgroundColor = JC.hex2rgb(bgc);\n    };\n\n\n\n    JC.hex2rgb = function(hex) {\n        return [(hex >> 16 & 0xFF) / 255, (hex >> 8 & 0xFF) / 255, (hex & 0xFF) / 255];\n    };\n\n    JC.rgb2hex = function(rgb) {\n        return ((rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255);\n    };\n\n    /**\n     * A polyfill for Function.prototype.bind\n     *\n     * @method bind\n     */\n    if (typeof Function.prototype.bind !== 'function') {\n        Function.prototype.bind = (function() {\n            return function(thisArg) {\n                var target = this,\n                    i = arguments.length - 1,\n                    boundArgs = [];\n                if (i > 0) {\n                    boundArgs.length = i;\n                    while (i--) boundArgs[i] = arguments[i + 1];\n                }\n\n                if (typeof target !== 'function') throw new TypeError();\n\n                function bound() {\n                    var i = arguments.length,\n                        args = new Array(i);\n                    while (i--) args[i] = arguments[i];\n                    args = boundArgs.concat(args);\n                    return target.apply(this instanceof bound ? this : thisArg, args);\n                }\n\n                bound.prototype = (function F(proto) {\n                    if (proto) F.prototype = proto;\n                    if (!(this instanceof F)) return new F();\n                })(target.prototype);\n\n                return bound;\n            };\n        })();\n    }\n\n    JC.getNextPowerOfTwo = function(number) {\n        if (number > 0 && (number & (number - 1)) === 0) // see: http://goo.gl/D9kPj\n            return number;\n        else {\n            var result = 1;\n            while (result < number) result <<= 1;\n            return result;\n        }\n    };\n\n    JC.isPowerOfTwo = function(width, height) {\n        return (width > 0 && (width & (width - 1)) === 0 && height > 0 && (height & (height - 1)) === 0);\n\n    };\n\n\n\n    JC.CompileVertexShader = function(gl, shaderSrc) {\n        return JC._CompileShader(gl, shaderSrc, gl.VERTEX_SHADER);\n    };\n\n    JC.CompileFragmentShader = function(gl, shaderSrc) {\n        return JC._CompileShader(gl, shaderSrc, gl.FRAGMENT_SHADER);\n    };\n\n    JC._CompileShader = function(gl, shaderSrc, shaderType) {\n        var src = shaderSrc.join(\"\\n\");\n        var shader = gl.createShader(shaderType);\n        gl.shaderSource(shader, src);\n        gl.compileShader(shader);\n\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            window.console.log(gl.getShaderInfoLog(shader));\n            return null;\n        }\n\n        return shader;\n    };\n\n    JC.compileProgram = function(gl, vertexSrc, fragmentSrc) {\n        var fragmentShader = JC.CompileFragmentShader(gl, fragmentSrc);\n        var vertexShader = JC.CompileVertexShader(gl, vertexSrc);\n\n        var shaderProgram = gl.createProgram();\n\n        gl.attachShader(shaderProgram, vertexShader);\n        gl.attachShader(shaderProgram, fragmentShader);\n        gl.linkProgram(shaderProgram);\n\n        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n            window.console.log(\"Could not initialise shaders\");\n        }\n\n        return shaderProgram;\n    };\n\n\n\n    JC.SpriteShader = function(gl) {\n        this._UID = JC._UID++;\n\n        this.gl = gl;\n\n        this.program = null;\n\n        this.fragmentSrc = [\n            'precision lowp float;',\n            'varying vec2 vTextureCoord;',\n\n            'uniform sampler2D uSampler;',\n            'uniform vec3 uTint;',\n            'uniform float uAlpha;',\n\n            'void main(void) {',\n            '   vec4 smpColor = texture2D(uSampler, vTextureCoord);',\n            '   gl_FragColor = vec4(uTint,uAlpha) * smpColor;',\n            '}'\n        ];\n\n        this.vertexSrc = [\n            'attribute vec2 aVertexPosition;',\n            'attribute vec2 aTextureCoord;',\n\n            'uniform vec2 projectionVector;',\n            'uniform mat3 uMatrix;',\n\n            'varying vec2 vTextureCoord;',\n\n            'void main(void) {',\n            '   vec2 v = ( uMatrix * vec3(aVertexPosition , 1.0) ).xy ;',\n            '   gl_Position = vec4( v / projectionVector , 0.0, 1.0);',\n            '   vTextureCoord = aTextureCoord;',\n            '}'\n        ];\n\n        this.textureCount = 0;\n\n        this.init();\n    };\n\n    JC.SpriteShader.prototype.constructor = JC.SpriteShader;\n\n    JC.SpriteShader.prototype.init = function() {\n        var gl = this.gl;\n\n        var program = JC.compileProgram(gl, this.vertexSrc, this.fragmentSrc);\n\n        gl.useProgram(program);\n\n        this.uSampler = gl.getUniformLocation(program, 'uSampler');\n        this.projectionVector = gl.getUniformLocation(program, 'projectionVector');\n        this.uMatrix = gl.getUniformLocation(program, 'uMatrix');\n        this.uTint = gl.getUniformLocation(program, 'uTint');\n        this.uAlpha = gl.getUniformLocation(program, 'uAlpha');\n\n        this.aVertexPosition = gl.getAttribLocation(program, 'aVertexPosition');\n        this.aTextureCoord = gl.getAttribLocation(program, 'aTextureCoord');\n\n        // this.attributes = [this.aVertexPosition, this.aPositionCoord];\n\n        this.program = program;\n    };\n\n    JC.SpriteShader.prototype.destroy = function() {\n        this.gl.deleteProgram(this.program);\n        this.uniforms = null;\n        this.gl = null;\n\n        // this.attributes = null;\n    };\n\n\n\n    JC.Renderer = function(width, height, options) {\n        if (options) {\n            for (var i in JC.defaultRenderOptions) {\n                if (typeof options[i] === 'undefined') options[i] = JC.defaultRenderOptions[i];\n            }\n        } else {\n            options = JC.defaultRenderOptions;\n        }\n\n        // JC.sayHello('webGL');\n\n        this.resolution = options.resolution || window.devicePixelRatio;\n\n        this.transparent = options.transparent;\n\n        this.autoResize = options.autoResize || false;\n\n        this.clearBeforeRender = options.clearBeforeRender || true;\n\n        this.width = width || 800;\n\n        this.height = height || 600;\n\n        this.view = options.view || document.createElement('canvas');\n\n        this.contextLostBound = this.handleContextLost.bind(this);\n\n        this.contextRestoredBound = this.handleContextRestored.bind(this);\n\n        this.view.addEventListener('webglcontextlost', this.contextLostBound, false);\n        this.view.addEventListener('webglcontextrestored', this.contextRestoredBound, false);\n\n        this._contextOptions = {\n            alpha: this.transparent,\n            antialias: options.antialias, // SPEED UP??\n            premultipliedAlpha: this.transparent && this.transparent !== 'notMultiplied',\n            stencil: true,\n            preserveDrawingBuffer: options.preserveDrawingBuffer\n        };\n\n        this.projection = new JC.Point();\n\n        this.offset = new JC.Point(0, 0);\n\n        this.shaderManager = new JC.ShaderManager();\n\n        this.texturesManager = new JC.TexturesManager();\n\n        this.maskManager = new JC.WebGLMaskManager();\n\n        // this.stencilManager = new JC.WebGLStencilManager();\n\n        this.blendModeManager = new JC.WebGLBlendModeManager();\n\n        this.renderSession = {};\n        this.renderSession.gl = this.gl;\n        this.renderSession.shaderManager = this.shaderManager;\n        this.renderSession.texturesManager = this.texturesManager;\n        this.renderSession.maskManager = this.maskManager;\n        this.renderSession.blendModeManager = this.blendModeManager;\n        // this.renderSession.stencilManager = this.stencilManager;\n        this.renderSession.renderer = this;\n        this.renderSession.resolution = this.resolution;\n\n        // time init the context..\n        this.initContext();\n\n        // map some webGL blend modes..\n        this.mapBlendModes();\n    };\n\n    // constructor\n    JC.Renderer.prototype.constructor = JC.Renderer;\n\n    /**\n     * @method initContext\n     */\n    JC.Renderer.prototype.initContext = function() {\n        var gl = this.view.getContext('webgl', this._contextOptions) || this.view.getContext('experimental-webgl', this._contextOptions);\n        this.gl = gl;\n\n        if (!gl) {\n            // fail, not able to get a context\n            throw new Error('This browser does not support webGL. Try using the canvas renderer');\n        }\n\n        // set up the default JC settings..\n        gl.disable(gl.DEPTH_TEST);\n        gl.disable(gl.CULL_FACE);\n        gl.enable(gl.BLEND);\n\n        // need to set the context for all the managers...\n        this.shaderManager.setContext(gl);\n        this.texturesManager.setContext(gl);\n        this.maskManager.setContext(gl);\n        this.blendModeManager.setContext(gl);\n\n        this.renderSession.gl = this.gl;\n\n        // now resize and we are good to go!\n        this.resize(this.width, this.height);\n\n    };\n\n    JC.Renderer.prototype.render = function(stage) {\n        // no point rendering if our context has been blown up!\n        if (this.contextLost) return;\n\n        // update the scene graph\n        stage.updateTransform();\n\n        var gl = this.gl;\n\n        // make sure we are bound to the main frame buffer\n        // gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        if (this.clearBeforeRender) {\n            if (this.transparent) {\n                gl.clearColor(0, 0, 0, 0);\n            } else {\n                gl.clearColor(stage.backgroundColor[0], stage.backgroundColor[1], stage.backgroundColor[2], 1);\n            }\n\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n\n        this.renderDisplayObject(stage, this.projection);\n    };\n\n    JC.Renderer.prototype.renderDisplayObject = function(displayObject, projection, buffer) {\n        this.renderSession.blendModeManager.setBlendMode(JC.blendModes.NORMAL);\n\n        // set the default projection\n        this.renderSession.projection = projection;\n\n        //set the default offset\n        this.renderSession.offset = this.offset;\n\n        // start the sprite batch\n        // this.spriteBatch.begin(this.renderSession);\n\n        // render the scene!\n        displayObject.render(this.renderSession);\n\n        // finish the sprite batch\n        // this.spriteBatch.end();\n    };\n\n    JC.Renderer.prototype.resize = function(width, height) {\n        this.width = width * this.resolution;\n        this.height = height * this.resolution;\n\n        this.view.width = this.width;\n        this.view.height = this.height;\n\n        if (this.autoResize) {\n            this.view.style.width = this.width / this.resolution + 'px';\n            this.view.style.height = this.height / this.resolution + 'px';\n        }\n\n        this.gl.viewport(0, 0, this.width, this.height);\n\n        this.projection.x = this.width / 2 / this.resolution;\n        this.projection.y = this.height / 2 / this.resolution;\n    };\n\n    JC.Renderer.prototype.handleContextLost = function(event) {\n        event.preventDefault();\n        this.contextLost = true;\n    };\n\n    JC.Renderer.prototype.handleContextRestored = function() {\n        this.initContext();\n\n        for (var key in JC.TextureCache) {\n            var texture = JC.TextureCache[key].baseTexture;\n            texture._glTextures = [];\n        }\n\n        this.contextLost = false;\n    };\n\n    JC.Renderer.prototype.mapBlendModes = function() {\n        var gl = this.gl;\n\n        if (!JC.blendModesWebGL) {\n            JC.blendModesWebGL = [];\n\n            JC.blendModesWebGL[JC.blendModes.NORMAL]      = [gl.ONE, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.ALPHA]      = [gl.ONE, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.ADD]         = [gl.SRC_ALPHA, gl.DST_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.MULTIPLY]    = [gl.DST_COLOR, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.SCREEN]      = [gl.SRC_ALPHA, gl.ONE];\n        }\n    };\n\n\n\n\n\n    JC.TexturesManager = function() {\n        this.textures = {};\n    };\n\n    JC.TexturesManager.prototype.constructor = JC.TexturesManager;\n\n    JC.TexturesManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n        // this.MAX_UNITS = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n        this._UNITS = 0;\n    };\n\n    JC.TexturesManager.prototype.setTexture = function(texture) {\n        var gl = this.gl;\n        if (this.currentId === texture.id) return false;\n\n        if(this.textures[texture.id]===undefined){\n            this.setPara(texture);\n        }\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.textures[texture.id].texture);\n        \n        this.currentId = texture.id;\n\n        return true;\n    };\n\n    JC.TexturesManager.prototype.setPara = function(texture) {\n        var gl = this.gl;\n\n        texture.texture = gl.createTexture();\n\n        // gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture.texture);\n        \n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.img);\n        \n        // gl.generateMipmap(gl.TEXTURE_2D);\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n        \n        texture.unit = this._UNITS;\n\n        this.textures[texture.id] = texture;\n\n        gl.bindTexture(gl.TEXTURE_2D, null);\n\n        this._UNITS++;\n    };\n\n    JC.TexturesManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n\n\n    JC.WebGLBlendModeManager = function() {\n        this.currentBlendMode = 99999;\n    };\n\n    JC.WebGLBlendModeManager.prototype.constructor = JC.WebGLBlendModeManager;\n\n    JC.WebGLBlendModeManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n    };\n\n    JC.WebGLBlendModeManager.prototype.setBlendMode = function(blendMode) {\n        if (this.currentBlendMode === blendMode) return false;\n\n        this.currentBlendMode = blendMode;\n\n        var blendModeWebGL = JC.blendModesWebGL[this.currentBlendMode];\n        this.gl.blendFunc(blendModeWebGL[0], blendModeWebGL[1]);\n\n        return true;\n    };\n\n    JC.WebGLBlendModeManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n    JC.ShaderManager = function()\n    {\n\n        this.shaders = {};\n\n    };\n\n    JC.ShaderManager.prototype.constructor = JC.ShaderManager;\n\n    JC.ShaderManager.prototype.setContext = function(gl)\n    {\n        this.gl = gl;\n\n        // this shader is used for the default sprite rendering\n        this.shaders['sprite'] = new JC.SpriteShader(gl);\n\n        this.setShader('sprite');\n    };\n\n\n    JC.ShaderManager.prototype.setShader = function(type)\n    {\n        if(this._curShaderType === type)return false;\n        \n        this._curShaderType = type;\n\n        this.shader = this.shaders[type];\n\n        this.gl.useProgram(this.shader.program);\n\n        return true;\n    };\n\n    JC.ShaderManager.prototype.destroy = function()\n    {\n        this.gl = null;\n    };\n\n\n\n\n    JC.WebGLMaskManager = function() {};\n\n    JC.WebGLMaskManager.prototype.constructor = JC.WebGLMaskManager;\n\n    JC.WebGLMaskManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n    };\n\n    JC.WebGLMaskManager.prototype.pushMask = function(maskData, renderSession) {\n        var gl = renderSession.gl;\n\n\n        gl.enable(gl.STENCIL_TEST);\n        gl.depthMask(false);\n        gl.colorMask(false, false, false, false);\n        gl.stencilFunc(gl.ALWAYS, 1, ~0);\n        gl.stencilOp(gl.KEEP, gl.REPLACE, gl.REPLACE);\n\n        // maskData.render();\n\n        gl.depthMask(true);\n        gl.colorMask(true, true, true, true);\n        gl.stencilFunc(gl.EQUAL, 1, ~0);\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\n    };\n\n    JC.WebGLMaskManager.prototype.popMask = function() {\n        var gl = this.gl;\n        gl.disable(gl.STENCIL_TEST);\n    };\n\n    JC.WebGLMaskManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n\n\n    /**\n     * @author Mat Groves http://matgroves.com/ @Doormat23\n     */\n\n    if (typeof exports !== 'undefined') {\n        if (typeof module !== 'undefined' && module.exports) {\n            exports = module.exports = JC;\n        }\n        exports.JC = JC;\n    } else if (typeof define !== 'undefined' && define.amd) {\n        define(JC);\n    } else {\n        root.JC = JC;\n    }\n\n})(this);\n","(function(){\n    window.JC = window.JC||{};\n    JC.Texture = function(id, img)\n    {\n        this.id = id;\n        this.img = img;\n        this.width = img.width;\n        this.height = img.height;\n    };\n\n\n    JC.TextureUvs = function()\n    {\n        this.x0 = 0;\n        this.y0 = 0;\n\n        this.x1 = 0;\n        this.y1 = 0;\n\n        this.x2 = 0;\n        this.y2 = 0;\n\n        this.x3 = 0;\n        this.y3 = 0;\n    };\n\n\n\n    JC.TextureCache = {};\n\n\n    JC.ImageLoader = function(sources, crossorigin){\n        this.receiveNum = 0;\n        this.failNum = 0;\n        this.requestNum = 0;\n        this.crossorigin = crossorigin;\n        this.sources = sources||{};\n        this.imgs = {};\n\n        this.loading();\n    };\n    JC.ImageLoader.prototype.constructor = JC.ImageLoader;\n    JC.ImageLoader.prototype.loading = function(){\n        var This = this;\n\n        function ears(source,img){\n            img.onload = function(){\n                This.receiveNum++;\n                JC.TextureCache[source] = new JC.Texture(source,img);\n                if((This.receiveNum+This.failNum)>=This.requestNum){\n                    This.onLoaded();\n                    This.failNum>0&&This.onFailed();\n                }\n            };\n            img.onerror = function (){\n                This.failNum++;\n            };\n        }\n\n        for(var source in this.sources){\n            this.imgs[source] = new Image();\n\n            ears(source,this.imgs[source]);\n\n            if(this.crossorigin){\n                this.imgs[source].crossOrigin = '';\n            }\n            this.imgs[source].src = this.sources[source];\n            this.requestNum++;\n        }\n    };\n    JC.ImageLoader.prototype.getTexture = function(id){\n        return JC.TextureCache[id];\n    };\n    JC.ImageLoader.prototype.onLoaded = function(){};\n    JC.ImageLoader.prototype.onFailed = function(){};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n})();","(function() {\n\n\twindow.JC = window.JC||{};\n\n\tJC.TWEEN = {\n\t\teaseBoth: function(t, b, c, d){  //加速减速曲线\n\t\t\tif ((t/=d/2) < 1) {\n\t\t\t\treturn c/2*t*t + b;\n\t\t\t}\n\t\t\treturn -c/2 * ((--t)*(t-2) - 1) + b;\n\t\t},\n\t\textend: function(opts){\n\t\t\tif(!opts)return;\n\t\t\tfor(var key in opts){\n\t\t\t\tif(key!=='extend'&&opts[key])this[key]=opts[key];\n\t\t\t}\n\t\t}\n\t};\n\n})();"]}